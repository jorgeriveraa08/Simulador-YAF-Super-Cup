<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YAF SUPERCUP 2026 | Live Telemetry</title>
    <style>
        :root {
            --bg-color: #0b0e11;
            --card-bg: #161a1e;
            --accent: #87ceeb; /* Changed to light blue */
            --text-main: #ffffff;
            --text-dim: #909090;
            --border: #2d333b;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 1000px;
            width: 100%;
        }

        header {
            text-align: center;
            border-bottom: 4px solid var(--accent);
            margin-bottom: 30px;
            padding-bottom: 10px;
            position: relative;
        }

        .logo {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: #87ceeb; /* Light blue background */
            color: white;
            width: 50px; /* Square dimensions */
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 0 10px #87ceeb, 0 0 20px #87ceeb; /* Neon glow */
        }

        h1 { 
            margin: 0; 
            letter-spacing: 2px; 
            font-weight: 800; 
            text-shadow: 0 0 10px var(--accent); /* Neon text shadow */
        }

        .dashboard {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 20px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5), 0 0 10px var(--accent); /* Added neon shadow */
        }

        .ronda-info {
            font-size: 1.2rem;
            color: var(--accent);
            font-weight: bold;
            margin-bottom: 15px;
            text-transform: uppercase;
            text-shadow: 0 0 5px var(--accent);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th {
            text-align: left;
            color: var(--text-dim);
            font-size: 0.8rem;
            text-transform: uppercase;
            padding: 10px;
            border-bottom: 1px solid var(--border);
        }

        td {
            padding: 12px 10px;
            border-bottom: 1px solid #252a30;
        }

        .pos { font-weight: bold; width: 40px; }
        .tag { color: var(--accent); font-weight: bold; width: 50px; }
        .vr { color: #00ff41; font-family: monospace; }

        .btn-simular {
            background: var(--accent);
            color: white;
            border: none;
            padding: 15px 30px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: transform 0.2s, background 0.2s, box-shadow 0.2s;
            margin-bottom: 20px;
            box-shadow: 0 0 10px var(--accent);
        }

        .btn-simular:hover {
            background: #ff1e1e;
            transform: scale(1.05);
            box-shadow: 0 0 20px var(--accent);
        }

        .standings-title {
            font-size: 1rem;
            border-left: 4px solid var(--accent);
            padding-left: 10px;
            margin-bottom: 15px;
            text-shadow: 0 0 5px var(--accent);
        }

        .medal { margin-right: 5px; }

        .history-section {
            margin-top: 30px;
            display: none;
        }

        .history-toggle {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 20px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
            box-shadow: 0 0 10px var(--accent);
            transition: box-shadow 0.2s;
        }

        .history-toggle:hover {
            box-shadow: 0 0 20px var(--accent);
        }

        .history-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5), 0 0 10px var(--accent);
            margin-bottom: 20px;
        }

        .history-title {
            font-size: 1.2rem;
            color: var(--accent);
            font-weight: bold;
            margin-bottom: 15px;
            text-transform: uppercase;
            text-shadow: 0 0 5px var(--accent);
        }

        .stats-section {
            margin-top: 30px;
            display: none;
        }

        .stats-toggle {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 20px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
            box-shadow: 0 0 10px var(--accent);
            transition: box-shadow 0.2s;
        }

        .stats-toggle:hover {
            box-shadow: 0 0 20px var(--accent);
        }

        .stats-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5), 0 0 10px var(--accent);
            margin-bottom: 20px;
        }

        .leader-highlight {
            color: var(--accent);
            font-weight: bold;
            text-shadow: 0 0 5px var(--accent);
        }

        .sort-select {
            margin-bottom: 10px;
            padding: 5px;
            background: var(--card-bg);
            color: var(--text-main);
            border: 1px solid var(--border);
            border-radius: 5px;
        }

        .events-section {
            margin-top: 30px;
            display: none;
        }

        .events-toggle {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 20px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
            box-shadow: 0 0 10px var(--accent);
            transition: box-shadow 0.2s;
        }

        .events-toggle:hover {
            box-shadow: 0 0 20px var(--accent);
        }

        .events-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5), 0 0 10px var(--accent);
            margin-bottom: 20px;
        }

        .event-item {
            margin-bottom: 10px;
            padding: 5px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }

        .team-highlight {
            color: var(--accent);
            font-weight: bold;
            text-shadow: 0 0 5px var(--accent);
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="logo">YSC</div>
        <h1>YAF SUPERCUP 2026</h1>
        <div id="sub-header" style="color: var(--text-dim);">SISTEMA DE CRONOMETRAJE OFICIAL</div>
    </header>

    <button class="btn-simular" onclick="simularSiguienteRonda()">SIMULAR SIGUIENTE RONDA</button>

    <div class="dashboard">
        <div class="card" style="grid-column: 1 / -1;">
            <div id="ronda-nombre" class="ronda-info">ESPERANDO INICIO...</div>
            <table id="tabla-carrera">
                <thead>
                    <tr><th>Pos</th><th>ID</th><th>Piloto</th><th>Gap</th><th>Vuelta</th></tr>
                </thead>
                <tbody id="body-carrera"></tbody>
            </table>
        </div>

        <div class="card">
            <div class="standings-title">MUNDIAL DE PILOTOS</div>
            <div id="leader-message" style="color: var(--accent); font-size: 0.9rem; margin-bottom: 10px;"></div>
            <table id="tabla-mundial">
                <thead><tr><th>Pos</th><th>Piloto</th><th>Pts</th></tr></thead>
                <tbody id="body-mundial"></tbody>
            </table>
        </div>

        <div class="card">
            <div class="standings-title">MUNDIAL DE CONSTRUCTORES</div>
            <div id="team-leader-message" style="color: var(--accent); font-size: 0.9rem; margin-bottom: 10px;"></div>
            <table id="tabla-equipos">
                <thead><tr><th>Pos</th><th>Equipo</th><th>Pts</th></tr></thead>
                <tbody id="body-equipos"></tbody>
            </table>
        </div>
    </div>

    <button class="events-toggle" onclick="toggleEvents()">VER LOG DE EVENTOS</button>
    <div class="events-section" id="events-section"></div>

    <button class="history-toggle" onclick="toggleHistory()">VER HISTORIAL DE CARRERAS</button>
    <div class="history-section" id="history-section"></div>

    <button class="stats-toggle" onclick="toggleStats()">VER ESTADÍSTICAS DE PILOTOS</button>
    <div class="stats-section" id="stats-section"></div>
</div>

<script>
    const rondas = [
        "R1-Enero (Sprint)", "R2-Enero (Carrera)", "R3-Marzo (Sprint)", 
        "R4-Abril (Sprint - LLUVIA)", "R5-Junio (Sprint)", "R6-Septiembre (Sprint)", 
        "R7-Octubre (Sprint)", "R8-Diciembre (Sprint)", "R9-Diciembre (Final S)", "R10-Diciembre (Final C)"
    ];

    let pilotos = [
        {"nombre": "J.Arias", "h": 30, "cons": "pocho_peor", "peso": 70, "learn": 0.0, "p_col": 0.50, "equipo": "Wazowski Tauri", "tag": "WT", pts: 0, victories: 0, podiums: 0, fastestLaps: 0, accidents: 0, sanctions: 0, positionsGained: 0},
        {"nombre": "P.Rivera", "h": 55, "cons": "pocho", "peso": 65, "learn": 0.7, "p_col": 0.15, "equipo": "Wazowski Tauri", "tag": "WT", pts: 0, victories: 0, podiums: 0, fastestLaps: 0, accidents: 0, sanctions: 0, positionsGained: 0},
        {"nombre": "J.Aguado", "h": 40, "cons": "pocho_peor", "peso": 70, "learn": 0.1, "p_col": 0.50, "equipo": "Dickies", "tag": "DK", pts: 0, victories: 0, podiums: 0, fastestLaps: 0, accidents: 0, sanctions: 0, positionsGained: 0},
        {"nombre": "J.Goula", "h": 65, "cons": "decente", "peso": 65, "learn": 0.4, "p_col": 0.25, "equipo": "Montgomery's", "tag": "MG", pts: 0, victories: 0, podiums: 0, fastestLaps: 0, accidents: 0, sanctions: 0, positionsGained: 0},
        {"nombre": "P.Aldea", "h": 70, "cons": "decente", "peso": 70, "learn": 0.5, "p_col": 0.15, "equipo": "Alfa Yayos", "tag": "AY", pts: 0, victories: 0, podiums: 0, fastestLaps: 0, accidents: 0, sanctions: 0, positionsGained: 0},
        {"nombre": "G.Alonso", "h": 80, "cons": "pro", "peso": 65, "learn": 0.4, "p_col": 0.20, "equipo": "Dickies", "tag": "DK", pts: 0, victories: 0, podiums: 0, fastestLaps: 0, accidents: 0, sanctions: 0, positionsGained: 0}, 
        {"nombre": "A.Hernández", "h": 90, "cons": "pro", "peso": 65, "learn": 0.6, "p_col": 0.30, "equipo": "El Yayo Racing", "tag": "YR", pts: 0, victories: 0, podiums: 0, fastestLaps: 0, accidents: 0, sanctions: 0, positionsGained: 0},
        {"nombre": "N.Bosqued", "h": 90, "cons": "pro", "peso": 95, "learn": 0.6, "p_col": 0.30, "equipo": "Montgomery's", "tag": "MG", pts: 0, victories: 0, podiums: 0, fastestLaps: 0, accidents: 0, sanctions: 0, positionsGained: 0},
        {"nombre": "J.Chueca", "h": 90, "cons": "pro", "peso": 70, "learn": 0.7, "p_col": 0.25, "equipo": "El Yayo Racing", "tag": "YR", pts: 0, victories: 0, podiums: 0, fastestLaps: 0, accidents: 0, sanctions: 0, positionsGained: 0},
        {"nombre": "J.Rivera", "h": 90, "cons": "pro", "peso": 72, "learn": 0.7, "p_col": 0.20, "equipo": "Alfa Yayos", "tag": "AY", pts: 0, victories: 0, podiums: 0, fastestLaps: 0, accidents: 0, sanctions: 0, positionsGained: 0},
        {"nombre": "R.Navarro", "h": 90, "cons": "pro", "peso": 75, "learn": 0.6, "p_col": 0.25, "equipo": "Caesaravgvsta", "tag": "CV", pts: 0, victories: 0, podiums: 0, fastestLaps: 0, accidents: 0, sanctions: 0, positionsGained: 0},
        {"nombre": "S.Rubio", "h": 52, "cons": "pocho", "peso": 75, "learn": 0.5, "p_col": 0.20, "equipo": "Caesaravgvsta", "tag": "CV", pts: 0, victories: 0, podiums: 0, fastestLaps: 0, accidents: 0, sanctions: 0, positionsGained: 0}
    ];

    let equipos = [
        {"nombre": "Wazowski Tauri", pts: 0, victories: 0, podiums: 0},
        {"nombre": "Dickies", pts: 0, victories: 0, podiums: 0},
        {"nombre": "Montgomery's", pts: 0, victories: 0, podiums: 0},
        {"nombre": "Alfa Yayos", pts: 0, victories: 0, podiums: 0},
        {"nombre": "El Yayo Racing", pts: 0, victories: 0, podiums: 0},
        {"nombre": "Caesaravgvsta", pts: 0, victories: 0, podiums: 0}
    ];

    let eventos = [];
    let rondaActual = 0;
    let ordenSalida = pilotos.map(p => p.nombre);
    let historialCarreras = [];

    function gaussRandom(mean, stdev) {
        let u = 1 - Math.random();
        let v = 1 - Math.random();
        return mean + stdev * Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
    }

    // --- FUNCIÓN ÚNICA DE SIMULACIÓN CORREGIDA ---
    function simularSiguienteRonda() {
        if (rondaActual >= rondas.length) { alert("¡Temporada finalizada!"); return; }

        const ronda = rondas[rondaActual];
        const esLluvia = ronda.includes("LLUVIA");
        const vueltas = (ronda.includes("Carrera") || ronda.includes("Final C")) ? 11 : 13;
        let resultados = [];

        // 1. Simulación de tiempos por vuelta
        ordenSalida.forEach(p_nom => {
            const p = pilotos.find(x => x.nombre === p_nom);
            let h_eff = p.h + (p.learn * rondaActual);
            let t_total = 0, mejor_v = 999, incs = 0, t_perdido = 0;

            for (let v = 1; v <= vueltas; v++) {
                let t_base = p.cons === "pro" ? 41.75 : p.cons === "decente" ? 42.75 : p.cons === "pocho" ? 43.55 : 44.0;
                let std = p.cons === "pro" ? 0.08 : 0.40;
                let factorPeso = (p.nombre === "N.Bosqued") ? 0.008 : 0.002;
                
                let v_raw = gaussRandom(t_base + (p.peso - 65) * factorPeso, std);
                if (p.nombre === "G.Alonso") v_raw += 0.05;

                let v_final = Math.max(v_raw, (p.cons === "pro" ? 41.3 : 42.7));
                if (esLluvia) v_final += (Math.random() * 0.6 + 0.6);

                // Probabilidad de error según habilidad (h) y p_col
                let probError = (p.p_col / vueltas) * (1 + (100 - h_eff) / 100);
                if (Math.random() < probError) {
                    let p_extra = Math.random() * 3 + 2; // Pierde entre 2 y 5 seg
                    v_final += p_extra;
                    t_perdido += p_extra;
                    incs++;
                }
                t_total += v_final;
                if (v_final < mejor_v) mejor_v = v_final;
            }
            resultados.push({ ...p, total: t_total, best: mejor_v, incs: incs, t_perdido: t_perdido });
        });

        // 2. Gestión de Incidentes y Sanciones
        let conIncidentes = resultados.filter(r => r.incs > 0);
        if (conIncidentes.length >= 2) {
            let agresividadTotal = conIncidentes.reduce((s, p) => s + p.p_col, 0);
            let ticket = Math.random() * agresividadTotal;
            let acc = 0, culpable = conIncidentes[0];
            for (let p of conIncidentes) {
                acc += p.p_col;
                if (ticket <= acc) { culpable = p; break; }
            }
            const sanction = Math.round((Math.random() * 10 + 5) / 5) * 5;
            culpable.total += sanction;
            pilotos.find(p => p.nombre === culpable.nombre).sanctions++;
            eventos.push(`${ronda}: COLISIÓN (${conIncidentes.map(i=>i.nombre).join(", ")}). ${culpable.nombre} sancionado +${sanction}s.`);
        } else if (conIncidentes.length === 1) {
            eventos.push(`${ronda}: ${conIncidentes[0].nombre} cometió un error individual y perdió ${conIncidentes[0].t_perdido.toFixed(2)}s.`);
        }

        // 3. Ordenar resultados finales tras sanciones
        resultados.sort((a, b) => a.total - b.total);
        const vr_p_nom = [...resultados].sort((a, b) => a.best - b.best)[0].nombre;

        // 4. Actualizar Puntos y Estadísticas
        resultados.forEach((r, idx) => {
            let pts = (12 - idx) > 0 ? (12 - idx) : 0;
            if (r.nombre === vr_p_nom) pts += 1;
            const pO = pilotos.find(p => p.nombre === r.nombre);
            pO.pts += pts;
            pO.accidents += r.incs;
            pO.positionsGained += (ordenSalida.indexOf(r.nombre) - idx);
            const tO = equipos.find(t => t.nombre === pO.equipo);
            tO.pts += pts;
            if (idx === 0) { pO.victories++; tO.victories++; }
            if (idx < 3) { pO.podiums++; tO.podiums++; }
            if (r.nombre === vr_p_nom) pO.fastestLaps++;
        });

        // 5. Guardar en historial y preparar UI
        historialCarreras.push({ ronda, startingGrid: [...ordenSalida], resultados: JSON.parse(JSON.stringify(resultados)), vr_p_nom });
        actualizarPantalla(ronda, resultados, vr_p_nom);
        
        // Parrilla para la siguiente basada en Vuelta Rápida
        ordenSalida = [...resultados].sort((a, b) => a.best - b.best).map(r => r.nombre);
        rondaActual++;
    }

    // --- FUNCIONES DE INTERFAZ ---
    function actualizarPantalla(ronda, resultados, vr_p_nom) {
        document.getElementById('ronda-nombre').innerText = ronda;
        
        const bodyC = document.getElementById('body-carrera');
        bodyC.innerHTML = resultados.map((r, i) => `
            <tr><td>${i+1}º</td><td class="tag">${r.tag}</td><td>${r.nombre} ${r.incs>0?'⚠️':''}</td>
            <td>${i===0?'LÍDER':'+'+(r.total-resultados[0].total).toFixed(2)+'s'}</td>
            <td class="${r.nombre===vr_p_nom?'vr':''}">${r.best.toFixed(3)} ${r.nombre===vr_p_nom?'★':''}</td></tr>
        `).join('');

        const mundial = [...pilotos].sort((a, b) => b.pts - a.pts);
        document.getElementById('leader-message').innerText = `Líder: ${mundial[0].nombre} con ${mundial[0].pts} pts`;
        document.getElementById('body-mundial').innerHTML = mundial.map((p, i) => `
            <tr><td>${i+1}</td><td>${p.nombre}</td><td><b>${p.pts}</b></td></tr>
        `).join('');

        const tea = [...equipos].sort((a, b) => b.pts - a.pts);
        document.getElementById('body-equipos').innerHTML = tea.map((e, i) => `
            <tr><td>${i+1}</td><td>${e.nombre}</td><td><b>${e.pts}</b></td></tr>
        `).join('');
    }

    function toggleEvents() {
        const sec = document.getElementById('events-section');
        sec.style.display = sec.style.display === 'block' ? 'none' : 'block';
        if(sec.style.display === 'block') {
            sec.innerHTML = `<div class="card"><div class="standings-title">LOG DE COMISARIOS</div>` + 
                (eventos.length ? eventos.slice().reverse().map(e => `<div style="padding:8px; border-bottom:1px solid #333; font-family:monospace; font-size:0.85rem;">${e}</div>`).join('') : "Sin eventos aún.") + `</div>`;
        }
    }

    function toggleHistory() {
        const sec = document.getElementById('history-section');
        sec.style.display = sec.style.display === 'block' ? 'none' : 'block';
        sec.innerHTML = historialCarreras.map(h => `<div class="card"><strong>${h.ronda}</strong> - Ganador: ${h.resultados[0].nombre} | VR: ${h.vr_p_nom}</div>`).join('');
    }

    function toggleStats() {
        const sec = document.getElementById('stats-section');
        sec.style.display = sec.style.display === 'block' ? 'none' : 'block';
        sec.innerHTML = `<div class="card"><div class="standings-title">STATS TEMPORADA</div><table><thead><tr><th>Piloto</th><th>Vic</th><th>Pod</th><th>VR</th><th>Sanc</th></tr></thead><tbody>` +
            pilotos.map(p => `<tr><td>${p.nombre}</td><td>${p.victories}</td><td>${p.podiums}</td><td>${p.fastestLaps}</td><td>${p.sanctions}</td></tr>`).join('') +
            `</tbody></table></div>`;
    }
</script>
</body>
</html>









